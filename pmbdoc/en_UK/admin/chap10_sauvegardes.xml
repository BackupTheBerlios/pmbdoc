<?xml version="1.0" encoding="UTF-8"?>
<chapter>
  <title lang='en'>Backup</title>

  <para lang='en'>Because PMB functions on a client/server model, you may not
  necessarily have access to the server from your PMB cataloguing and
  administration console.</para>

  <para lang='en'>PMB enables you to make remote backups of the database on your server
  and then to repatriate them on your computer for copying on a CD or USB
  storage stick.</para>

  <para lang='en'>In PMB backups are done by sets of tables, this enables you to backup
  only those data that you choose to keep. Thus backups of loans transactions
  and the readers' file could be effected on a daily basis while the backups
  of catalogue records and copies could be done weekly, monthly or even from
  time to time.</para>

  <sect1 id="admin_sauv_lieux">
    <title lang='en'>Backup locations</title>

    <para lang='en'>A backup location may be situated locally on your computer or on a
    remotely situated computer for safekeeping of the backup file. The server
    must have read/write privileges on the backup location.</para>

    <figure>
      <title lang='en'>Backup &gt; Backup location</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_lieux.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_tables">
    <title lang='en'>Groups of tables</title>

    <para lang='en'>It is about the grouping of tables to backup simultaneously. You do
    not necessarily have to make a daily backup of your records (a weekly
    backup, or after every import/calatoguing is enough. On the other hand,
    loans being frequent you may need regular backups for borrowers and
    issues.</para>

    <figure>
      <title lang='en'>Backup &gt; Groups of tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_groupes.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para lang='en'>If you have loaded the data supplied in
    <emphasis>feed_essential.sql</emphasis>, you already have at your disposal
    a backup set ready to use (for more information see <xref
    linkend="donnees_minimum" />).</para>

    <para lang='en'>Here is a list of tables from the various groups pre-loaded with the
    test data set.</para>

    <table>
      <title lang='en'>Groups of tables pre-loaded with feed_essential.sql</title>

      <tgroup cols="3">
        <thead>
          <row>
            <entry lang="en">Name of group of tables</entry>

            <entry lang="en">Description</entry>

            <entry lang="en">Content</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry lang="en">Application</entry>

            <entry lang="en">Tables required to make PMB function</entry>

            <entry lang="en">categ_assoc categories explnum indexint lenders
            notices_categories origine_notice parametres procs quotas
            sauv_lieux sauv_log sauv_sauvegardes sauv_tables users</entry>
          </row>

          <row>
            <entry lang="en">Of no use</entry>

            <entry lang="en">Tables whose contents there is no need to backup</entry>

            <entry lang="en">error_log import_marc sessions</entry>
          </row>

          <row>
            <entry lang="en">Authorities</entry>

            <entry lang="en">Tables relating to Authorities files</entry>

            <entry lang="en">authors collections publishers responsability series
            sub_collections</entry>
          </row>

          <row>
            <entry lang="en">Biblio</entry>

            <entry lang="en">Bibliographic data tables</entry>

            <entry lang="en">analysis bulletins docs_codestat docs_location docs_section
            docs_statut docs_type exemplaires notices</entry>
          </row>

          <row>
            <entry lang="en">Caddies</entry>

            <entry lang="en">Caddies, their content and related procedures</entry>

            <entry lang="en">caddie caddie_content caddie_procs</entry>
          </row>

          <row>
            <entry lang="en">Borrowers</entry>

            <entry lang="en">Readers files, loans, holds</entry>

            <entry lang="en">empr empr_categ empr_codestat empr_custom empr_custom_lists
            empr_custom_values empr_groupe groupe pret pret_archive
            resa</entry>
          </row>

          <row>
            <entry lang="en">feed_example</entry>

            <entry lang="en">content of feed_example.sql</entry>

            <entry lang="en">analysis authors bulletins collections docs_codestat
            docs_location docs_section docs_statut docs_type empr empr_categ
            empr_codestat empr_groupe exemplaires groupe lenders notices pret
            pret_archive publishers resa responsability series sub_collections
            users</entry>
          </row>

          <row>
            <entry lang="en">ALL</entry>

            <entry lang="en">all the tables of the database</entry>

            <entry lang="en"></entry>
          </row>

          <row>
            <entry lang="en">Z3950</entry>

            <entry lang="en">Z39.50 servers profiles</entry>

            <entry lang="en">z_attr z_bib z_notices z_query</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para lang='en'>To create a new set of tables, click on <emphasis>Add a set of
    tables</emphasis>. Then tick the various tables corresponding to your
    set.</para>

    <figure>
      <title lang='en'>Backup : editing a set of tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/sauv_jeu_edit.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_gestsauv">
    <title lang='en'>Backup sets</title>

    <para lang='en'>A backup set is made up of a group of tables and a backup
    location.</para>

    <para lang='en'>Backing up borrowers and loans in c:/pmb_backups/date/bibli.sav is
    valid.</para>

    <figure>
      <title lang='en'>Backup &gt; Backup sets</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_jeux.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <figure>
      <title lang='en'>Backup &gt; Backup sets &gt; editing a backup set</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/jeu-sauv.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_launch">
    <title lang='en'>Start backup</title>

    <para lang='en'>When a backup set is ready, all you need to do is start the backup.
    You can test here whether your parameters work.</para>

    <figure>
      <title lang='en'>Backup &gt; Start backup</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/admin_sauv_lanc.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para lang='en'>The same window pops-up when a user clicks on the "backup" link near
    "Quit" on the top right of the PMB screen.</para>

    <figure>
      <title lang='en'>Backup pop-up</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/sauv_popup.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_list">
    <title lang='en'>Backups done</title>

    <para lang='en'>On the following screen, you can visualize the various backups made,
    display errors, if any, encountered during the backup, repatriate the data
    or delete the backups of your choice (for example old ones).</para>

    <figure>
      <title lang='en'>Backup &gt; Backups made</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/admin_sauv_list.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1>
    <title lang='en'>Restore a backup made on another PMB installation</title>

    <para lang='en'>PMB has a hidden module for the restoration of backups in case of
    emergency :</para>

    <para lang='en'><programlisting>http://MACHINE/PMB/admin/sauvegarde/emergency/emergency.php</programlisting></para>

    <para lang='en'>You will have to upload the file (pay attention to max_upload_size
    of php.ini).</para>

    <figure>
      <title lang='en'>Emergency restore module</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_emerg_restore.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para lang='en'>You will be needing the database username and password (bibli/bibli
    by default)</para>
  </sect1>
</chapter>