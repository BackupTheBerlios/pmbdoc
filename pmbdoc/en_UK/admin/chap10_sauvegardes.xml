<?xml version="1.0" encoding="UTF-8"?>
<chapter>
  <title>Backup</title>

  <para>Because PMB functions on a client/server model, you may not
  necessarily have access to the server from your PMB cataloguing and
  administration console.</para>

  <para>PMB enables you to make remote backups of the database on your server
  and then to repatriate them on your computer for copying on a CD or USB
  storage stick.</para>

  <para>In PMB backups are done by sets of tables, this enables you to backup
  only those data that you choose to keep. Thus backups of loans transactions
  and the readers' file could be effected on a daily basis while the backups
  of catalogue records and copies could be done weekly, monthly or even from
  time to time.</para>

  <sect1 id="admin_sauv_lieux">
    <title>Backup locations</title>

    <para>A backup location may be situated locally on your computer or on a
    remotely situated computer for safekeeping of the backup file. The server
    must have read/write privileges on the backup location.</para>

    <figure>
      <title>Backup &gt; Backup location</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_lieux.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_tables">
    <title>Groups of tables</title>

    <para>It is about the constitution of groups of tables to backup
    simultaneously. You do not necessarily have to make a daily backup of your
    records (a weekly backup, or after every import/calatoguing is enough. On
    the other hand, loans being frequent you may need regular backups for
    borrowers and issues.</para>

    <figure>
      <title>Backup &gt; Groups of tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_groupes.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>If you have loaded the data supplied in
    <emphasis>feed_essential.sql</emphasis>, you already have at your disposal
    a backup set ready to use (for more information see <xref
    linkend="donnees_minimum" />).</para>

    <para>Here is a list of tables from the various groups pre-loaded with the
    test data set.</para>

    <table>
      <title>Groups of tables pre-loaded with feed_essential.sql</title>

      <tgroup cols="3">
        <thead>
          <row>
            <entry>Name of group of tables</entry>

            <entry>Description</entry>

            <entry>Content</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Application</entry>

            <entry>Tables required to make PMB function</entry>

            <entry>categ_assoc categories explnum indexint lenders
            notices_categories origine_notice parametres procs quotas
            sauv_lieux sauv_log sauv_sauvegardes sauv_tables users</entry>
          </row>

          <row>
            <entry>Of no use</entry>

            <entry>Tables whose contents there is no need to backup</entry>

            <entry>error_log import_marc sessions</entry>
          </row>

          <row>
            <entry>Authorities</entry>

            <entry>Tables relating to Authorities files</entry>

            <entry>authors collections publishers responsability series
            sub_collections</entry>
          </row>

          <row>
            <entry>Biblio</entry>

            <entry>Bibliographic data tables </entry>

            <entry>analysis bulletins docs_codestat docs_location docs_section
            docs_statut docs_type exemplaires notices</entry>
          </row>

          <row>
            <entry>Caddies</entry>

            <entry>Caddies, their content and related procedures</entry>

            <entry>caddie caddie_content caddie_procs</entry>
          </row>

          <row>
            <entry>Borrowers</entry>

            <entry>Readers files, loans, holds</entry>

            <entry>empr empr_categ empr_codestat empr_custom empr_custom_lists
            empr_custom_values empr_groupe groupe pret pret_archive
            resa</entry>
          </row>

          <row>
            <entry>feed_example</entry>

            <entry>content of feed_example.sql</entry>

            <entry>analysis authors bulletins collections docs_codestat
            docs_location docs_section docs_statut docs_type empr empr_categ
            empr_codestat empr_groupe exemplaires groupe lenders notices pret
            pret_archive publishers resa responsability series sub_collections
            users</entry>
          </row>

          <row>
            <entry>ALL</entry>

            <entry>all the tables of the database</entry>

            <entry></entry>
          </row>

          <row>
            <entry>Z3950</entry>

            <entry>Z39.50 servers profiles</entry>

            <entry>z_attr z_bib z_notices z_query</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>To create a nes set of tables, click on <emphasis>Add a set of
    tables</emphasis>. Then tick the various tables corresponding to your
    set.</para>

    <figure>
      <title>Backup : editing a set of tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/sauv_jeu_edit.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_gestsauv">
    <title>Backup sets</title>

    <para>A backup set is made up of a group of tables/backup location.</para>

    <para>Backing up borrowers and loans in c:/pmb_backups/date/bibli.sav is
    valid.</para>

    <figure>
      <title>Backup &gt; Backup sets</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_jeux.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <figure>
      <title>Backup &gt; Backup sets &gt; editing a backup set</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/jeu-sauv.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_launch">
    <title>Start backup</title>

    <para>When a backup set is ready, all you need to do is start the backup.
    You can test here whether your parameters work.</para>

    <figure>
      <title>Backup &gt; Start backup</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/admin_sauv_lanc.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>The same window pops-up when a user clicks on "backup" link near
    "Quit" on the top right of the PMB screen.</para>

    <figure>
      <title>Backup pop-up</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/sauv_popup.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_list">
    <title>Backups done</title>

    <para>On the following screen, you can visualize the various backups made,
    display errors, if any, encountered during the backup, repatriate the data
    or delete the backups of your choice (for example old ones).</para>

    <figure>
      <title>Backup &gt; Backups made</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../../pmb2.1/doc/documentation/en_UK/html-admin/images/admin_sauv_list.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1>
    <title>Restore a backup made on another PMB installation</title>

    <para>PMB has a hidden module for the emergency restoration of backups
    :</para>

    <para><programlisting>http://MACHINE/PMB/admin/sauvegarde/emergency/emergency.php</programlisting></para>

    <para>You will have to upload the file (pay attention to max_upload_size
    of php.ini)</para>

    <figure>
      <title>Emergency restore module</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_emerg_restore.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>You will be needing the database username and password (bibli/bibli
    by default)</para>
  </sect1>
</chapter>