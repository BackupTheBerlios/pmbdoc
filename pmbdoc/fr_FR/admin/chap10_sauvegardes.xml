<?xml version="1.0" encoding="UTF-8"?>
<chapter>
  <title>Sauvegarde</title>

  <para>PMB fonctionnant sur un modèle de client/serveur, vous n'avez pas
  forcément accès au serveur depuis votre console de catalogage et
  d'administration PMB.</para>

  <para>PMB permet de sauvegarder à distance la base dans un fichier sur le
  serveur puis de le rapatrier sur votre ordinateur pour le copier sur un CD
  ou sur un stick mémoire USB.</para>

  <para>La sauvegarde dans PMB se fait par jeux de tables, ceci vous permet de
  ne sauvegarder que les données de votre choix. Ainsi la sauvegarde des prêts
  et du fichier lecteur pourrait être quotidienne, alors que la sauvegarde des
  notices et des exemplaires issus du catalogage pourrait être hebdomadaire,
  mensuelle ou ponctuelle.</para>

  <sect1 id="admin_sauv_lieux">
    <title>Lieux de sauvegarde</title>

    <para>Un lieu de sauvegarde est un emplacement informatique sur votre
    ordinateur ou à distance où le fichier doit être sauvegardé. Le serveur
    doit avoir la possibilité d'écriture directe à cet endroit.</para>

    <figure>
      <title>Sauvegarde &gt; Lieux de sauvegarde</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_lieux.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_tables">
    <title>Groupes de tables</title>

    <para>Il s'agit de la constitution de groupes de tables qui seront
    sauvegardées simultanément. Vous n'avez pas forcément besoin de
    sauvegarder vos notices quotidiennement (une sauvegarde hebdomadaire ou à
    chaque import/catalogage suffit), mais les prêts étant fréquents vous
    pouvez avoir besoin d'une sauvegarde fréquente des emprunteurs et des
    prêts.</para>

    <figure>
      <title>Sauvegarde &gt; Groupes de tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_groupes.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Si vous avez chargé les données correspondant au fichier
    <emphasis>feed_essential.sql</emphasis>, vous disposez d'un jeu de
    sauvegarde opérationnel (pour plus d'informations voir <xref
    linkend="donnees_minimum" />.</para>

    <para>Voici la liste des tables dans les différents groupes chargés avec
    le jeu de test opérationnel.</para>

    <table>
      <title>Groupes de tables chargés par feed_essential.sql</title>

      <tgroup cols="3">
        <thead>
          <row>
            <entry>Nom du groupe de tables</entry>

            <entry>Descriptif</entry>

            <entry>Contenu</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Application</entry>

            <entry>Tables utilisées par le fonctionnement de l'application
            PMB</entry>

            <entry>categ_assoc categories explnum indexint lenders
            notices_categories origine_notice parametres procs quotas
            sauv_lieux sauv_log sauv_sauvegardes sauv_tables users</entry>
          </row>

          <row>
            <entry>Aucune utilité</entry>

            <entry>Tables dont le contenu n'a pas besoin d'être
            sauvegardé</entry>

            <entry>error_log import_marc sessions</entry>
          </row>

          <row>
            <entry>Autorités</entry>

            <entry>Tables correspondant aux données des autorités</entry>

            <entry>authors collections publishers responsability series
            sub_collections</entry>
          </row>

          <row>
            <entry>Biblio</entry>

            <entry>Tables contenant les données bibliographiques</entry>

            <entry>analysis bulletins docs_codestat docs_location docs_section
            docs_statut docs_type exemplaires notices</entry>
          </row>

          <row>
            <entry>Caddies</entry>

            <entry>Les caddies, leurs procédures et leurs contenus</entry>

            <entry>caddie caddie_content caddie_procs</entry>
          </row>

          <row>
            <entry>Emprunteurs</entry>

            <entry>Fichiers lecteurs, prets et réservations</entry>

            <entry>empr empr_categ empr_codestat empr_custom empr_custom_lists
            empr_custom_values empr_groupe groupe pret pret_archive
            resa</entry>
          </row>

          <row>
            <entry>feed_example</entry>

            <entry>contenu de feed_example.sql</entry>

            <entry>analysis authors bulletins collections docs_codestat
            docs_location docs_section docs_statut docs_type empr empr_categ
            empr_codestat empr_groupe exemplaires groupe lenders notices pret
            pret_archive publishers resa responsability series sub_collections
            users</entry>
          </row>

          <row>
            <entry>TOUT</entry>

            <entry>toutes les tables de la base</entry>

            <entry></entry>
          </row>

          <row>
            <entry>Z3950</entry>

            <entry>profils des serveurs Z39.50</entry>

            <entry>z_attr z_bib z_notices z_query</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

    <para>Pour créer un nouveau jeu de tables, cliquez sur <emphasis>Ajouter
    un jeu de tables</emphasis>. Puis cochez les différentes tables qui
    correspondent à votre jeu.</para>

    <figure>
      <title>Sauvegarde : édition d'un jeu de tables</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/sauv_jeu_edit.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_gestsauv">
    <title>Jeux de sauvegardes</title>

    <para>Un jeu de sauvegarde constitue un groupe jeu de table/lieu de
    sauvegarde.</para>

    <para>Sauvegarder les emprunteurs et les prêts dans
    c:/sauvegardes_pmb/date_du_jour/bibli.sav est par exemple un jeu
    valide.</para>

    <figure>
      <title>Sauvegarde &gt; Jeux de sauvegarde</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_jeux.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <figure>
      <title>Sauvegarde &gt; Jeux de sauvegarde, édition d'un jeu de
      sauvegarde</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/jeu-sauv.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_launch">
    <title>Lancement sauvegarde</title>

    <para>Quand un jeu de sauvegarde est constitué, il n'y a plus qu'à lancer
    la sauvegarde. Vous pouvez ici tester le bon fonctionnement de vos
    paramètres.</para>

    <figure>
      <title>Sauvegarde &gt; Lancement sauvegarde</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_lanc.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Il s'agit en fait de la même fenêtre qui apparaît dans un popup,
    lors du clic d'un utilisateur sur le lien "sauv." à coté du lien "quitter"
    en haut à droit de l'écran de PMB.</para>

    <figure>
      <title>Popup de sauvegarde</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/sauv_popup.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1 id="admin_sauv_list">
    <title>Sauvegardes faites</title>

    <para>Depuis cet écran vous pouvez consulter les sauvegardes qui ont été
    réalisées, afficher le cas échéant les erreurs rencontrées lors de la
    sauvegarde, rapatrier les données ou supprimer les sauvegardes de votre
    choix (par exemple les plus anciennes).</para>

    <figure>
      <title>Sauvegarde &gt; Sauvegardes faites</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_sauv_list.gif" />
        </imageobject>
      </mediaobject>
    </figure>
  </sect1>

  <sect1>
    <title>Restaurer une sauvegarde faite sur une autre installation de
    PMB</title>

    <para>PMB dispose d'un module caché de restauration de sauvegardes
    :</para>

    <para><programlisting>http://MACHINE/PMB/admin/sauvegarde/emergency/emergency.php</programlisting></para>

    <para>Ceci va demander d'uploader le fichier (attention au max_upload_size
    de php.ini) et hop !</para>

    <figure>
      <title>Module de restauration d'urgence</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/admin_emerg_restore.gif" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Vous aurez besoin du mot de passe de la base de données (par défaut
    bibli/bibli)</para>
  </sect1>
</chapter>